(function(i){i.state_machine=function(e){var j=function(){};j.current_state=e.initial;j.transitioning=false;var d,c;for(d in e.states){c=function(m,n){var h=arguments.callee.state_machine,g=h["to_"+h.current_state],f=arguments.callee,b=g.transitions[f.state_name];if(h.transitioning)return false;if(typeof b=="function")b=b(m);if(b){b=[];var a;b.push(function(k,l){h.transitioning=true;l(k)});a=[];g.before_leave&&a.push(g.before_leave);f.before_enter&&a.push(f.before_enter);a.length>0&&b.push(i.stacks.parallel(a));
a=[];g.leave&&a.push(g.leave);f.enter&&a.push(f.enter);a.length>0&&b.push(i.stacks.parallel(a));b.push(function(k,l){h.current_state=f.state_name;l(k)});a=[];g.after_leave&&a.push(g.after_leave);f.after_enter&&a.push(f.after_enter);a.length>0&&b.push(i.stacks.parallel(a));b.push(function(k,l){h.transitioning=false;l(k)});i.stacks.serial(b)(m,n);return true}else return false};c.state_name=d;c.state_machine=j;c.before_enter=e.states[d].before_enter;c.before_leave=e.states[d].before_leave;c.enter=e.states[d].enter;
c.leave=e.states[d].leave;c.after_enter=e.states[d].after_enter;c.after_leave=e.states[d].after_leave;c.transitions=e.transitions[d];j["to_"+d]=c}return j}})(jQuery);
