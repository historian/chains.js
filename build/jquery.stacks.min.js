(function(h){h.stacks={};h.stacks.sync=function(f){return function(c,a){a(f.call(this,c))}};h.stacks.serial=function(){var f={};f.b=arguments.length==1&&arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.call(arguments,0);var c,a;c=function(b,e,d,j){function m(l){a.call(k,e,l||d,j)}var k=this;m.d=function(l){j||j.d?j.d(l||d):a.call(k,[],l||d,j)};b.call(k,d,m)};a=function(b,e,d){if(b.length==0)d&&d.call(this,e);else c.call(this,b.shift(),b,e,d)};var g;g=function(b){function e(j,m){var k=
[],l;for(l in d.b)k.push(d.b[l]);a.call(this,k,j,m)}var d={b:[]};for(i in b.b)d.b[i]=b.b[i];e.c=d;e.toString=function(){return"serial:["+e.c.b.toString()+"]"};e.push=function(j){var m=g(d);m.c.b.push(j);return m};return e};return g(f)};h.stacks.parallel=function(){function f(a,g,b,e){var d=this;a[g].call(d,b,function(){delete a[g];a.length-=1;a.length<=0&&e&&e.call(d,b,e)})}var c;c=arguments.length==1&&arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.call(arguments,0);return function(a,
g){var b={},e;b.length=c.length;for(e in c)b[e]=c[e];for(var d in b)d!="length"&&f.call(this,b,d,a,g)}};h.stacks.cascade=function(){var f={};f.a=arguments.length==1&&arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.call(arguments,0);var c,a;c=function(b,e,d,j){function m(l){a.call(k,"done",l||d,j)}var k=this;m.pass=function(l){a.call(k,e,l||d,j)};b.call(k,d,m)};a=function(b,e,d){if(b=="done")d&&d.call(this,e);else if(b.length==0)d&&d.pass&&d.pass(e);else c.call(this,b.shift(),b,e,d)};
var g;g=function(b){function e(j,m){var k=[],l;for(l in d.a)k[l]=d.a[l];a.call(this,k,j,m)}var d={a:[]};for(i in b.a)d.a[i]=b.a[i];e.c=d;e.toString=function(){return"cascade:["+e.c.a.toString()+"]"};e.push=function(j,m){if(m){d.a.push(j);return this}else{var k=g(d);k.c.a.push(j);return k}};return e};return g(f)};h.stacks.ajax=function(f){var c=f.key||"response";delete f.key;return function(a,g){h.extend(f,{success:function(b,e,d){a[c]={success:true,data:b,textStatus:e,XMLHttpRequest:d};g(a)},error:function(b,
e,d){a[c]={success:false,errorThrown:d,textStatus:e,XMLHttpRequest:b};g(a)}});h.e(f)}};h.stacks.batch_ajax=function(f){var c,a,g=[];for(c in f){a=f[c];a.key=c;g.push(h.stacks.ajax(a))}return h.stacks.parallel(g)};h.stacks.image=function(f,c){c||(c="images");return function(a,g){var b=new Image;b.onload=function(){a[c]||(a[c]=[]);b.status="success";a[c].push(b);g(a)};b.onerror=function(){a[c]||(a[c]=[]);b.status="error";a[c].push(b);g(a)};b.onabort=function(){a[c]||(a[c]=[]);b.status="abort";a[c].push(b);
g(a)};b.src=f}};h.stacks.images=function(f,c){var a,g=[];for(a in f)g.push(h.stacks.image(f[a],c));return h.stacks.parallel(g)};h.stacks.preload_image=function(f,c){c||(c="data-src");return function(a,g){var b=h(f).f(c);f.onload=function(){f.status="success";g(a)};f.onerror=function(){f.status="error";g(a)};f.onabort=function(){f.status="abort";g(a)};f.src=b}};h.stacks.preload_images=function(f,c,a){c||(c="data-src");var g=[],b;h(f).find("img["+c+"]").g(function(){b=h.stacks.preload_image(this,c);
if(a)b=h.stacks.serial([b,a]);g.push(b)});return h.stacks.parallel(g)}})(jQuery);
