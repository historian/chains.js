(function(j){var l;j.stacks={};j.stacks.sync=function(e){return function(b,d){d(e.call(this,b))}};j.stacks.serial=function(){var e,b,d,g,f;e=function(a){if(a.a.length==0)a.c&&a.c.call(this,a.d);else{var c=a.a.shift(),k=l(this,a,function(h){if(h.e)h.a=[];e.call(this,h)});c.call(this,a.d,k)}};b=function(a){function c(k,h){f.call(this,arguments.callee.b,k,h)}c.b={a:[]};c.toString=d;c.push=g;for(i in a.a)c.b.a[i]=a.a[i];return c};f=function(a,c,k){c={a:[],d:c,c:k};for(var h in a.a)c.a[h]=a.a[h];e.call(this,
c)};d=function(){return"serial:["+this.b.a.toString()+"]"};g=function(a){var c=b(this.b);c.b.a.push(a);return c};return function(a){return b({a:a})}}();j.stacks.parallel=function(){var e,b,d,g,f;e=function(a,c){var k=l(this,c,function(h){h.length-=1;h.length==0&&h.c&&h.c.call(this,h.d)});a.call(this,c.d,k)};b=function(a){function c(k,h){f.call(this,arguments.callee.b,k,h)}c.b={a:[]};c.toString=d;c.push=g;for(i in a.a)c.b.a[i]=a.a[i];return c};f=function(a,c,k){c={a:{},d:c,c:k};var h;c.length=a.a.length;
for(h in a.a)c.a[h]=a.a[h];for(h in c.a)e.call(this,c.a[h],c)};d=function(){return"parallel:["+this.b.a.toString()+"]"};g=function(a){var c=b(this.b);c.b.a.push(a);return c};return function(a){return b({a:a})}}();j.stacks.cascade=function(){var e,b,d,g,f;f=function(a){if(a.f)a.c&&a.c.call(this,a.d);else if(a.a.length==0)a.c&&a.c.pass&&a.c.pass(a.d);else{var c=a.a.shift(),k=l(this,a,function(h){if(!h.e)h.f=true;f.call(this,h)});c.call(this,a.d,k)}};e=function(a){function c(k,h){g.call(this,arguments.callee.b,
k,h)}c.b={a:[]};c.toString=b;c.push=d;for(i in a.a)c.b.a[i]=a.a[i];return c};g=function(a,c,k){c={a:[],d:c,c:k,f:false};for(var h in a.a)c.a[h]=a.a[h];f.call(this,c)};b=function(){return"cascade:["+this.b.a.toString()+"]"};d=function(a,c){if(c){this.b.a.push(a);return this}else{var k=e(this.b);k.b.a.push(a);return k}};return function(a){return e({a:a})}}();j.stacks.image=function(e,b){b||(b="images");return function(d,g){var f=new Image;f.onload=function(){d[b]||(d[b]=[]);f.status="success";d[b].push(f);
g(d)};f.onerror=function(){d[b]||(d[b]=[]);f.status="error";d[b].push(f);g(d)};f.onabort=function(){d[b]||(d[b]=[]);f.status="abort";d[b].push(f);g(d)};f.src=e}};j.stacks.images=function(e,b){var d,g=[];for(d in e)g.push(j.stacks.image(e[d],b));return j.stacks.parallel(g)};j.stacks.ajax=function(e){var b=e.key||"response";delete e.key;return function(d,g){j.extend(e,{success:function(f,a,c){d[b]={success:true,data:f,textStatus:a,XMLHttpRequest:c};g(d)},error:function(f,a,c){d[b]={success:false,errorThrown:c,
textStatus:a,XMLHttpRequest:f};g(d)}});j.g(e)}};j.stacks.batch_ajax=function(e){var b,d,g=[];for(b in e){d=e[b];d.key=b;g.push(j.stacks.ajax(d))}return j.stacks.parallel(g)};j.stacks.preload_image=function(e,b){b||(b="data-src");return function(d,g){var f=j(e).h(b);e.onload=function(){e.status="success";g(d)};e.onerror=function(){e.status="error";g(d)};e.onabort=function(){e.status="abort";g(d)};e.src=f}};j.stacks.preload_images=function(e,b,d){b||(b="data-src");var g=[],f;j(e).find("img["+b+"]").i(function(){f=
j.stacks.preload_image(this,b);if(d)f=j.stacks.serial([f,d]);g.push(f)});return j.stacks.parallel(g)};l=function(e,b,d){function g(f){b.d=f||b.d;b.e=false;d.call(e,b)}g.pass=function(f){b.d=f||b.d;b.e=true;b.c&&b.c.pass?b.c.pass(b.d):d.call(e,b)};return g}})(jQuery);
