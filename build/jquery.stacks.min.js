(function(h){var n;h.stacks={};h.stacks.sync=function(d){return function(b,c){c(d.call(this,b))}};h.stacks.serial=function(){var d,b,c,f;d=function(a){if(a.a.length==0)a.e&&a.e.call(this,a.b);else{var e=a.a.shift(),g=n(this,a,function(j){if(j.f)j.a=[];d.call(this,j)});e.call(this,a.b,g)}};b=function(a){var e={a:[]};for(i in _state.a)e.a[i]=a.a[i];a=function(g,j){var l={a:[],b:g,e:j},k;for(k in e.a)l.a[k]=e.a[k];d.call(this,l)};a.c=e;a.toString=c;a.push=f;return a};c=function(){return"serial:["+this.c.a.toString()+
"]"};f=function(a){var e=b(this.c);e.c.a.push(a);return e};return function(a){return b({a:a})}}();h.stacks.parallel=function(){var d,b,c,f;d=function(a,e){var g=n(this,e,function(j){j.length-=1;j.length==0&&j.e&&j.e.call(this,j.b)});a.call(this,e.b,g)};b=function(a){var e={a:[]};for(i in _state.a)e.a[i]=a.a[i];a=function(g,j){var l={a:{},b:g,e:j},k;l.length=e.a.length;for(k in e.a)l.a[k]=e.a[k];for(k in l.a)d.call(this,l.a[k],l)};a.c=e;a.toString=c;a.push=f;return a};c=function(){return"parallel:["+
this.c.a.toString()+"]"};f=function(a){var e=b(this.c);e.c.a.push(a);return e};return function(a){return b({a:a})}}();h.stacks.cascade=function(){var d={};d.d=arguments.length==1&&arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.call(arguments,0);var b,c;b=function(a,e,g,j){function l(m){c.call(k,"done",m||g,j)}var k=this;l.pass=function(m){c.call(k,e,m||g,j)};a.call(k,g,l)};c=function(a,e,g){if(a=="done")g&&g.call(this,e);else if(a.length==0)g&&g.pass&&g.pass(e);else b.call(this,a.shift(),
a,e,g)};var f;f=function(a){function e(j,l){var k=[],m;for(m in g.d)k[m]=g.d[m];c.call(this,k,j,l)}var g={d:[]};for(i in a.d)g.d[i]=a.d[i];e.c=g;e.toString=function(){return"cascade:["+e.c.d.toString()+"]"};e.push=function(j,l){if(l){g.d.push(j);return this}else{var k=f(g);k.c.d.push(j);return k}};return e};return f(d)};h.stacks.ajax=function(d){var b=d.key||"response";delete d.key;return function(c,f){h.extend(d,{success:function(a,e,g){c[b]={success:true,data:a,textStatus:e,XMLHttpRequest:g};f(c)},
error:function(a,e,g){c[b]={success:false,errorThrown:g,textStatus:e,XMLHttpRequest:a};f(c)}});h.g(d)}};h.stacks.batch_ajax=function(d){var b,c,f=[];for(b in d){c=d[b];c.key=b;f.push(h.stacks.ajax(c))}return h.stacks.parallel(f)};h.stacks.image=function(d,b){b||(b="images");return function(c,f){var a=new Image;a.onload=function(){c[b]||(c[b]=[]);a.status="success";c[b].push(a);f(c)};a.onerror=function(){c[b]||(c[b]=[]);a.status="error";c[b].push(a);f(c)};a.onabort=function(){c[b]||(c[b]=[]);a.status=
"abort";c[b].push(a);f(c)};a.src=d}};h.stacks.images=function(d,b){var c,f=[];for(c in d)f.push(h.stacks.image(d[c],b));return h.stacks.parallel(f)};h.stacks.preload_image=function(d,b){b||(b="data-src");return function(c,f){var a=h(d).h(b);d.onload=function(){d.status="success";f(c)};d.onerror=function(){d.status="error";f(c)};d.onabort=function(){d.status="abort";f(c)};d.src=a}};h.stacks.preload_images=function(d,b,c){b||(b="data-src");var f=[],a;h(d).find("img["+b+"]").i(function(){a=h.stacks.preload_image(this,
b);if(c)a=h.stacks.serial([a,c]);f.push(a)});return h.stacks.parallel(f)};n=function(d,b,c){function f(a){b.b=a||b.b;b.f=false;c.call(d,b)}f.pass=function(a){b.b=a||b.b;b.f=true;b.e&&b.e.pass?b.e.pass(b.b):c.call(d,b)};return f}})(jQuery);
