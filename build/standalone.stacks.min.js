(function(k){var l;k.stacks={};k.stacks.sync=function(g){return function(c,e){e(g.call(this,c))}};k.stacks.serial=function(){var g,c,e,j,f;g=function(a){if(a.a.length==0)a.c&&a.c.call(this,a.d);else{var b=a.a.shift(),h=l(this,a,function(d){if(d.e)d.a=[];g.call(this,d)});b.call(this,a.d,h)}};c=function(a){function b(h,d){f.call(this,arguments.callee.b,h,d)}b.b={a:[]};b.toString=e;b.push=j;for(i in a.a)b.b.a[i]=a.a[i];return b};f=function(a,b,h){b={a:[],d:b,c:h};for(var d in a.a)b.a[d]=a.a[d];g.call(this,
b)};e=function(){return"serial:["+this.b.a.toString()+"]"};j=function(a){var b=c(this.b);b.b.a.push(a);return b};return function(a){return c({a:a})}}();k.stacks.parallel=function(){var g,c,e,j,f;g=function(a,b){var h=l(this,b,function(d){d.length-=1;d.length==0&&d.c&&d.c.call(this,d.d)});a.call(this,b.d,h)};c=function(a){function b(h,d){f.call(this,arguments.callee.b,h,d)}b.b={a:[]};b.toString=e;b.push=j;for(i in a.a)b.b.a[i]=a.a[i];return b};f=function(a,b,h){b={a:{},d:b,c:h};var d;b.length=a.a.length;
for(d in a.a)b.a[d]=a.a[d];for(d in b.a)g.call(this,b.a[d],b)};e=function(){return"parallel:["+this.b.a.toString()+"]"};j=function(a){var b=c(this.b);b.b.a.push(a);return b};return function(a){return c({a:a})}}();k.stacks.cascade=function(){var g,c,e,j,f;f=function(a){if(a.f)a.c&&a.c.call(this,a.d);else if(a.a.length==0)a.c&&a.c.pass&&a.c.pass(a.d);else{var b=a.a.shift(),h=l(this,a,function(d){if(!d.e)d.f=true;f.call(this,d)});b.call(this,a.d,h)}};g=function(a){function b(h,d){j.call(this,arguments.callee.b,
h,d)}b.b={a:[]};b.toString=c;b.push=e;for(i in a.a)b.b.a[i]=a.a[i];return b};j=function(a,b,h){b={a:[],d:b,c:h,f:false};for(var d in a.a)b.a[d]=a.a[d];f.call(this,b)};c=function(){return"cascade:["+this.b.a.toString()+"]"};e=function(a,b){if(b){this.b.a.push(a);return this}else{var h=g(this.b);h.b.a.push(a);return h}};return function(a){return g({a:a})}}();k.stacks.image=function(g,c){c||(c="images");return function(e,j){var f=new Image;f.onload=function(){e[c]||(e[c]=[]);f.status="success";e[c].push(f);
j(e)};f.onerror=function(){e[c]||(e[c]=[]);f.status="error";e[c].push(f);j(e)};f.onabort=function(){e[c]||(e[c]=[]);f.status="abort";e[c].push(f);j(e)};f.src=g}};k.stacks.images=function(g,c){var e,j=[];for(e in g)j.push(k.stacks.image(g[e],c));return k.stacks.parallel(j)};l=function(g,c,e){function j(f){c.d=f||c.d;c.e=false;e.call(g,c)}j.pass=function(f){c.d=f||c.d;c.e=true;c.c&&c.c.pass?c.c.pass(c.d):e.call(g,c)};return j}})(this);
