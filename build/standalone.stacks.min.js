(function(m){m.stacks={};m.stacks.sync=function(l){return function(j,d){d(l.call(this,j))}};m.stacks.serial=function(){var l={};l.b=arguments.length==1&&arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.call(arguments,0);var j,d;j=function(c,b,a,e){function h(g){d.call(f,b,g||a,e)}var f=this;h.d=function(g){e||e.d?e.d(g||a):d.call(f,[],g||a,e)};c.call(f,a,h)};d=function(c,b,a){if(c.length==0)a&&a.call(this,b);else j.call(this,c.shift(),c,b,a)};var k;k=function(c){function b(e,h){var f=
[],g;for(g in a.b)f.push(a.b[g]);d.call(this,f,e,h)}var a={b:[]};for(i in c.b)a.b[i]=c.b[i];b.c=a;b.toString=function(){return"serial:["+b.c.b.toString()+"]"};b.push=function(e){var h=k(a);h.c.b.push(e);return h};return b};return k(l)};m.stacks.parallel=function(){function l(d,k,c,b){var a=this;d[k].call(a,c,function(){delete d[k];d.length-=1;d.length<=0&&b&&b.call(a,c,b)})}var j;j=arguments.length==1&&arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.call(arguments,0);return function(d,
k){var c={},b;c.length=j.length;for(b in j)c[b]=j[b];for(var a in c)a!="length"&&l.call(this,c,a,d,k)}};m.stacks.cascade=function(){var l={};l.a=arguments.length==1&&arguments[0]instanceof Array?arguments[0]:Array.prototype.slice.call(arguments,0);var j,d;j=function(c,b,a,e){function h(g){d.call(f,"done",g||a,e)}var f=this;h.pass=function(g){d.call(f,b,g||a,e)};c.call(f,a,h)};d=function(c,b,a){if(c=="done")a&&a.call(this,b);else if(c.length==0)a&&a.pass&&a.pass(b);else j.call(this,c.shift(),c,b,a)};
var k;k=function(c){function b(e,h){var f=[],g;for(g in a.a)f[g]=a.a[g];d.call(this,f,e,h)}var a={a:[]};for(i in c.a)a.a[i]=c.a[i];b.c=a;b.toString=function(){return"cascade:["+b.c.a.toString()+"]"};b.push=function(e,h){if(h){a.a.push(e);return this}else{var f=k(a);f.c.a.push(e);return f}};return b};return k(l)}})(this);
